<div class="sm:h-screen flex flex-col xl:flex-row justify-between p-4 mx-auto">
  <div>
    <h1>Panel de Calidad del Aire</h1>
    <div class="flex sm:flex-row sm:items-center flex-col mt-4 justify-stretch">
      <button matButton="filled" class="sm:w-96" (click)="togglePositionBbox()">mostrar sensores cerca de ti</button>
      <button matButton="filled" class="sm:w-96 sm:ml-5 sm:mt-0 mt-5" (click)="togglePositionDefault()">mostrar todos
        los sensores</button>
    </div>
    @defer {
    <div class="flex sm:flex-row sm:items-center flex-col mt-4 justify-stretch">
      <mat-form-field class="sm:w-96">
        <mat-label>Selecciona una ubicación</mat-label>
        <mat-select [(ngModel)]="selectedId" (selectionChange)="onSelectId($event.value)">
          <mat-option [value]="null">Ninguno</mat-option>
          @for (elem of elemts(); track elem.id) {
          <mat-option [value]="elem.id">{{ elem.locality }} - {{ elem.name }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
      <mat-form-field class="sm:ml-5 sm:w-96">
        <mat-label>Buscar lugar</mat-label>
        <input type="text" matInput placeholder="Buscar" [matAutocomplete]="auto" [(ngModel)]="inputValue"
          (input)="filter()" />

        <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onSelectId($event.option.value)">
          @for (e of filteredRes; track e.id) {
          <mat-option [value]="e.id">
            {{ e.locality }} - {{ e.name }}
          </mat-option>
          }
        </mat-autocomplete>
      </mat-form-field>
    </div>
    }
    @loading (minimum 300ms) {
    <app-loading></app-loading>
    }
    @error{
    <p>error</p>
    }




    <div class="p-4 rounded-lg fondo_leyenda shadow-sm">
      @defer (when selectedId() !==null) {
      <h2 class="text-lg font-semibold mb-2">Parámetros de Calidad del Aire en {{"[WIP]"}}</h2>
      <div class="flex flex-col gap-8">
        @for (param of parameters(); track param.id) {
        <div>
          {{param.name}} - {{param.value}}
        </div>
        }
      </div>
      }
      @loading (minimum 500ms) {
      <ngx-skeleton-loader count="5" appearance="line" size="100px" [theme]="{height: '50px', background: 'black'}" />
      }
      @placeholder {
      <p class="h-auto sm:h-32 flex justify-center items-center text-gray-200">selecciona una localidad para empezar</p>
      }
    </div>
  </div>
  <!-- el ejercicio -->
  <div class="flex sm:flex-col flex-col-reverse">
    <div class="rounded-lg fondo_leyenda shadow-sm p-2 mt-5 xl:mx-5">
      <h3 class="text-lg font-semibold mb-2">Leyenda de Parámetros</h3>
      <ul class="space-y-1 text-sm">
        <li>
          <strong>O₃</strong>: Ozono troposférico (µg/m³).
          <em>Formado por reacciones químicas entre contaminantes. Irritante respiratorio.</em>
          • Bajo: &lt; 60 µg/m³ — Moderado: 60–120 µg/m³ — Alto: &gt; 120 µg/m³
        </li>
        <li>
          <strong>PM₁₀</strong>: Partículas en suspensión ≤ 10 µm (µg/m³).
          <em>Partículas inhalables que pueden causar problemas respiratorios.</em>
          • Bajo: &lt; 20 µg/m³ — Moderado: 20–50 µg/m³ — Alto: &gt; 50 µg/m³
        </li>
        <li>
          <strong>PM₂.₅</strong>: Partículas finas ≤ 2.5 µm (µg/m³).
          <em>Más dañinas por su capacidad de penetrar profundamente en los pulmones.</em>
          • Bajo: &lt; 10 µg/m³ — Moderado: 10–25 µg/m³ — Alto: &gt; 25 µg/m³
        </li>
        <li>
          <strong>NO₂</strong>: Dióxido de Nitrógeno (µg/m³).
          <em>Producido por vehículos y procesos industriales. Irrita pulmones.</em>
          • Bajo: &lt; 40 µg/m³ — Moderado: 40–100 µg/m³ — Alto: &gt; 100 µg/m³
        </li>
        <li>
          <strong>NO</strong>: Monóxido de Nitrógeno (µg/m³).
          <em>Emisión directa de vehículos. Se oxida fácilmente a NO₂.</em>
          • Bajo: &lt; 25 µg/m³ — Moderado: 25–75 µg/m³ — Alto: &gt; 75 µg/m³
        </li>
        <li>
          <strong>SO₂</strong>: Dióxido de Azufre (µg/m³).
          <em>Emitido por la combustión de carbón y petróleo. Puede agravar enfermedades respiratorias.</em>
          • Bajo: &lt; 50 µg/m³ — Moderado: 50–125 µg/m³ — Alto: &gt; 125 µg/m³
        </li>
      </ul>
    </div>
    <!-- bloque fijo de la calidad de aire del primer sitio de la lista que se devuelve con la pong serve --no-hmrsicion automatica -->
    @defer (when isPosition() == true){
    <div class="rounded-lg fondo_leyenda shadow-sm p-2 mt-5 xl:mx-5">
      <h3 class="sm:text-2xl text-xl text-center border-b">En tu zona: {{firstPositionName()}}</h3>
      <div class="grid grid-cols-4">
        @for(e of closestElement(); track e.name){
        <div
          class="transform transition-transform duration-300 ease-in-out hover:scale-150 active:scale-100 shadow-md hover:shadow-xl rounded-lg overflow-hidden rounded-lg shadow-sm p-2 m-2 fondo_card_measurement flex flex-col size-auto text-center">
          <div>{{e.name}}</div>
          <div>{{e.value}}</div>
        </div>
        }
      </div>
    </div>
    }
    @loading (minimum 1s){
    <app-loading></app-loading>
    }
    @placeholder {
    <div
      class="rounded-lg shadow-sm p-2 mt-5 xl:m-5 fondo_card_measurement flex flex-col size-auto text-center text-gray-200">
      selecciona sensores mas cercanos para empezar
    </div>
    }
  </div>
</div>